# Выборка данных

## Выборка всех данных из таблицы
**структура:**
  <pre><code>
  ключевое слово SELECT; 
  символ « * » ; 
  ключевое слово FROM; 
  имя таблицы.
  </code></pre>
**пример:** <code>SELECT * FROM book;</code>
  
## Выборка данных из отдельных столбцов
**структура:**
  <pre><code>
  ключевое слово SELECT ; 
  список столбцов таблицы через запятую; 
  ключевое слово FROM ; 
  имя таблицы.
  </code></pre>
**пример:** <code>SELECT title, amount FROM book;</code>

## Выборка отдельных столбцов и присвоение им новых имен
**структура:**
  <pre><code>
  ключевое слово SELECT ; 
  имя столбца;
  ключевое слово AS ; 
  новое название столбца (например, Количество_книг) ; 
  запятая; 
  имя столбца; 
  .... 
  ключевое слово FROM ; 
  имя таблицы.
  </code></pre>
**пример:** <code>SELECT title AS Название, amount FROM book;</code>

## Выборка данных, вычисляемые столбцы, логические функции
**структура:**
  <pre><code>
  IF(логическое_выражение, выражение_1, выражение_2)
  </code></pre>
Функция вычисляет логическое_выражение, если оно истина – в поле заносится значение выражения_1, в противном случае –  значение выражения_2. Все три параметра IF() являются обязательными.  
**пример:** <code>SELECT title, amount, price, 
    IF(amount<4, price*0.5, price*0.7) AS sale
FROM book;</code>

## Выборка данных по условию
Логическое выражение может включать операторы сравнения (равно «=», не равно «<>», больше «>», меньше «<», больше или равно«>=», меньше или равно «<=») и выражения, допустимые в SQL.  
**пример:** <code>SELECT title, price 
FROM book
WHERE price < 600;</code>

## Выборка данных, вычисляемые столбцы, математические функции
    CEILING(x) - возвращает наименьшее целое число, большее или равное x (округляет до целого числа в большую сторону)
    ROUND(x, k) - округляет значение x до k знаков после запятой, если k не указано – x округляется до целого
    FLOOR(x) - 	возвращает наибольшее целое число, меньшее или равное x (округляет до  целого числа в меньшую сторону)
    POWER(x, y) - возведение x в степень y
    SQRT(x) - 	квадратный корень из x
    DEGREES(x) - конвертирует значение x из радиан в градусы
    RADIANS(x) - 	конвертирует значение x из градусов в радианы
    ABS(x) - модуль числа x
    PI() - pi = 3.1415926...
**пример:** <code>SELECT title, price, 
    (price*18/100)/(1+18/100) AS tax, 
    price/(1+18/100) AS price_tax 
FROM book;</code>
  
## Выборка данных, логические операции
Логическое выражение после ключевого слова WHERE кроме операторов сравнения  и выражений может включать  логические операции (И «and», ИЛИ «or», НЕ «not») и круглые скобки, изменяющие приоритеты выполнения операций.  

Приоритеты операций:  
1. круглые скобки
2. умножение  (*),  деление (/)
3. сложение  (+), вычитание (-)
4. операторы сравнения (=, >, <, >=, <=, <>)
5. NOT
5. AND
7. OR  

**пример:** <code>SELECT title, author, price 
FROM book
WHERE price > 600 AND author = 'Булгаков М.А.';</code>
  
## Выборка данных, операторы BETWEEN, IN
Логическое выражение после ключевого слова WHERE может включать операторы  BETWEEN и IN. Приоритет  у этих операторов такой же как у операторов сравнения, то есть они выполняются раньше, чем NOT, AND, OR.  
Оператор BETWEEN позволяет отобрать данные, относящиеся к некоторому интервалу, включая его границы.  
**пример:** <code>SELECT title, amount 
FROM book
WHERE amount BETWEEN 5 AND 14;</code>
 
## Выборка данных с сортировкой
  По умолчанию ORDER BY выполняет сортировку по возрастанию. Чтобы управлять направлением сортировки вручную, после имени столбца указывается ключевое слово ASC (по возрастанию) или DESC (по убыванию). 
**структура:**  
  <pre><code>
  FROM
  WHERE
  SELECT
  ORDER BY
  </code></pre>
**пример:** <code>SELECT title, author, price
FROM book
ORDER BY title;</code>
  
## Выборка данных, оператор LIKE
**структура:**
  <pre><code>
  % - Любая строка, содержащая ноль или более символов
  _ (подчеркивание) - Любой одиночный символ
  </code></pre>
**пример:** <code>SELECT title 
FROM book
WHERE title LIKE 'Б%';</code>

  

  
# Запросы, групповые операции
  
## Выбор уникальных элементов столбца
Чтобы отобрать уникальные элементы некоторого столбца используется ключевое слово DISTINCT, которое размещается сразу после SELECT.  
**пример:** <code>SELECT DISTINCT author
FROM book;</code>

## Выборка данных, групповые функции SUM и COUNT
   <pre><code>
   sum() - сумма
   count() - количество
   </code></pre>
**пример:** <code>SELECT author, sum(amount), count(amount)
FROM book
GROUP BY author;</code>

## Выборка данных, групповые функции MIN, MAX и AVG
**структура:**
  <pre><code>
  MIN() - минимальное значение
  MAX() - максимальное значение
  AVG() - среднее значение
  </code></pre>
**пример:** <code>SELECT author, MIN(price) AS min_price
FROM book
GROUP BY author;</code>
  
## Выборка данных c вычислением, групповые функции
В качестве аргумента групповых функций  SQL может использоваться не только столбец, но и любое допустимое в SQL арифметическое выражение.  
**пример:** <code>SELECT author, SUM(price * amount) AS Стоимость
FROM book
GROUP BY author;</code>
  
## Выборка данных по условию, групповые функции
В запросы с групповыми функциями можно включать условие отбора строк, которое в обычных запросах записывается после WHERE. В запросах с групповыми функциями вместо WHERE используется ключевое слово HAVING , которое размещается после оператора GROUP BY.  
**пример:** <code>SELECT author,
    MIN(price) AS Минимальная_цена, 
    MAX(price) AS Максимальная_цена
FROM book
GROUP BY author
HAVING SUM(price * amount) > 5000; </code>
  
# Вложенные запросы
Вложенный запрос используется для выборки данных, которые будут использоваться в условии отбора записей основного запроса. Его применяют для:
1. сравнения выражения с результатом вложенного запроса;
2. определения того, включено ли выражение в результаты вложенного запроса;
3. проверки того, выбирает ли запрос определенные строки.
**структура:**
  <pre><code>
ключевое слово SELECT  после которого указываются имена столбцов или выражения (чаще всего список содержит один элемент) ;
ключевое слово FROM и имя таблицы, из которой выбираются данные;
необязательное предложение WHERE;
необязательное предложение GROUP BY:
необязательное предложение HAVING.
  </code></pre>

Вложенные запросы  могут включаться в WHERE или HAVING так (в квадратных скобках указаны необязательные элементы, через | – один из элементов):
<pre><code>
WHERE | HAVING выражение оператор_сравнения (вложенный запрос);
WHERE | HAVING выражение, включающее вложенный запрос;
WHERE | HAVING выражение [NOT] IN (вложенный запрос);
WHERE | HAVING выражение  оператор_сравнения  ANY | ALL (вложенный запрос).
</code></pre>

## Вложенный запрос, возвращающий одно значение
**пример:** <code>SELECT title, author, price, amount
FROM book
WHERE price = (
         SELECT MIN(price) 
         FROM book
      );</code>
  
## Использование вложенного запроса в выражении
**пример:** <code>SELECT title, author, amount 
FROM book
WHERE ABS(amount - (SELECT AVG(amount) FROM book)) >3;</code>
  
## Вложенный запрос, оператор IN
**пример:** <code>SELECT title, author, amount, price
FROM book
WHERE author IN (
        SELECT author 
        FROM book 
        GROUP BY author 
        HAVING SUM(amount) >= 12
      );</code>
  
## Вложенный запрос, операторы ANY и ALL
 Вложенный запрос, возвращающий несколько значений одного столбца, можно использовать для отбора записей с помощью операторов ANY и ALL совместно с операциями отношения (=, <>, <=, >=, <, >).  
**Важно!** Операторы ALL и ANY можно использовать только с вложенными запросами. В примерах выше (10, 12) приводится как результат вложенного запроса просто для того, чтобы показать как эти операторы работают. В запросах так записывать нельзя.  
**пример:** <code>SELECT title, author, amount, price
FROM book
WHERE amount < ALL (
        SELECT AVG(amount) 
        FROM book 
        GROUP BY author 
      );</code>
  
 ## Вложенный запрос после SELECT
**пример:** <code>SELECT title, author, amount, 
    (
     SELECT AVG(amount) 
     FROM book
    ) AS Среднее_количество 
FROM book
WHERE abs(amount - (SELECT AVG(amount) FROM book)) >3;</code>


# Запросы корректировки данных
## Создание пустой таблицы
**структура:**
  <pre><code>
ключевые слова : CREATE TABLE
имя создаваемой таблицы;
открывающая круглая скобка «(»;
название поля и его описание, которое включает тип поля и другие необязательные характеристики;
запятая;
название поля и его описание;
...
закрывающая скобка «)».
  </code></pre>
**пример:** <code>CREATE TABLE genre(
    genre_id INT PRIMARY KEY AUTO_INCREMENT, 
    name_genre VARCHAR(30)
);</code>
  
## Добавление записей в таблицу
**структура:**
  <pre><code>
  INSERT INTO имя_таблицы(столбец_1, столбец_2, ..., столбец_N)
VALUES
    (значение_1_1, значение_1_2, ..., значение_1_N),
    (значение_2_1, значение_2_2, ..., значение_2_N),
    ...
    (значение_M_1, значение_M_2, ..., значение_M_N);
  </code></pre>
**пример:** <code>INSERT INTO book (title, author, price, amount) 
VALUES 
    ('Война и мир','Толстой Л.Н.', 1070.20, 2),
    ('Анна Каренина', 'Толстой Л.Н.', 599.90, 3);</code>
  
## Добавление записей из другой таблицы
С помощью запроса на добавление можно не только добавить в таблицу конкретные значения (список VALUES), но и записи из другой таблицы, отобранные с помощью запроса на выборку.  В этом случае вместо раздела VALUES записывается запрос на выборку, начинающийся с SELECT.  В нем можно использовать WHERE, GROUP BY, ORDER BY.  

Правила соответствия между полями таблицы и вставляемыми значениями из запроса:  

1. количество полей в таблице и количество полей в запросе должны совпадать;
2. должно существовать прямое соответствие между позицией одного и того же элемента в обоих списках, поэтому первый столбец запроса должен относиться к первому столбцу в списке столбцов таблицы, второй – ко второму столбцу и т.д.
3. типы столбцов запроса должны быть совместимы с типами данных соответствующих столбцов таблицы ( целое число можно занести в поле типа DECIMAL, обратная операция – недопустима).  
**пример:** <code>INSERT INTO book (title, author, price, amount) 
SELECT title, author, price, amount 
FROM supply;</code>
  
## Запросы на обновление
**структура:**
  <pre><code>
  UPDATE таблица SET поле = выражение
  </code></pre>
  где  
- таблица – имя таблицы, в которой будут проводиться изменения;  
- поле – поле таблицы, в которое будет внесено изменение;  
- выражение – выражение,  значение которого будет занесено в поле.   

**пример:** <code>UPDATE book 
SET price = 0.7 * price;</code>
  
## Запросы на обновление нескольких столбцов
**структура:**
  <pre><code>
  UPDATE таблица SET поле1 = выражение1, поле2 = выражение2
  </code></pre>
**пример:** <code>UPDATE book 
SET amount = amount - buy,
    buy = 0;</code>
  
## Запросы на обновление нескольких таблиц 
В запросах на обновление можно использовать несколько таблиц, но тогда
- для столбцов, имеющих одинаковые имена, необходимо указывать имя таблицы, к которой они относятся;
- все таблицы, используемые в запросе, нужно перечислить после ключевого слова UPDATE;
- в запросе обязательно условие WHERE, в котором указывается условие при котором обновляются данные.
**пример:** <code>UPDATE book, supply 
SET book.amount = book.amount + supply.amount
WHERE book.title = supply.title AND book.author = supply.author;</code>
  
## Запросы на удаление
Запросы корректировки данных позволяют удалить одну или несколько записей из  таблицы.  
**структура:**
  <pre><code>
  DELETE FROM таблица;
  </code></pre>
**пример:** <code>DELETE FROM supply;</code>  
  
Запрос на удаления позволяет удалить не все записи таблицы, а только те, которые удовлетворяют условию, указанному после ключевого слова WHERE.  
**структура:**
  <pre><code>
DELETE FROM таблица WHERE условие;
  </code></pre>  
**пример:** <code>DELETE FROM supply 
WHERE title IN (
        SELECT title 
        FROM book
      );</code>
