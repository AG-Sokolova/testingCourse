# Charles Proxy
[Как приручить Charles Proxy?](https://habr.com/ru/company/youla/blog/527648/)  

#### настройка для Firefox Mozilla
1. Установить приложение Charles Proxy
2. Запустить Charles Proxy
3. Поставить галочку *Proxy > Windows (IOS) Proxy*
4. Установить сертификат *Help > SSL Proxying > Install Charles Root Certificate > Установить сертификат > Помещаем в "Доверенные корневые центры сертификации" (для текущего и локального пользователя)*. Должно появиться уведомление об успешном импорте сертификата.
5. Запомнить IP адрес ПК *Help > Local IP Address*
6. Открыть настройки браузера
7. На вкладке Основные перейти в раздел *Параметры сети* и кликнуть *Настроить*
8. В окне выбрать *Ручная настройка прокси*. Ввести:

     - HTTP/HTTPS прокси: IP адрес ПК
     - SSL прокси: IP адрес ПК
     - Порт: 8888
9. Перейти на сайт [chils.pro/ssl](chils.pro/ssl). 

     - если все верно настроено, то появится автоматическое скачивание сертификата
     - в этот момент появится входящее соединение, необходимо кликнуть *allow*.
10. Скаченный сертификат поместить *Настройки > Приватность и защита > Просмотр сертификатов > Импортировать скаченный файл*
11. В Charles Proxy перейти "Proxy > SSL Proxying Settings":

      - поставить галочку *Enable SSL Proxying*

      - в Include добавить: host <code>*.*</code>, host <code>*</code>, host <code>[]</code>


**Отключить прокси:**
- *Настройки браузера > Основные > Параметры сети > Настроить > Выбрать "без прокси"*
- *Параметры ПК > Сеть и интернет > Прокси сервер > Отключить настройки прокси вручную*

#### настройка для Chrome
1. Установить приложение Charles Proxy
2. Запустить Charles Proxy
3. Поставить галочку *Proxy > Windows (IOS) Proxy*
4. Установить сертификат *Help > SSL Proxying > Install Charles Root Certificate > Установить сертификат > Помещаем в "Доверенные корневые центры сертификации" (для текущего и локального пользователя)*. Должно появиться уведомление об успешном импорте сертификата.
5. Запомнить IP адрес ПК *Help > Local IP Address*
6. Открыть настройки браузера
7. *Настройки > Дополнительные настройки > Система > Открыть настройки прокси сервера для компьютера*
8. В окне включить *Настройки прокси сервера вручную*
9. Перейти на сайт [chils.pro/ssl](chils.pro/ssl). 

     - если все верно настроено, то появится автоматическое скачивание сертификата
     - в этот момент появится входящее соединение, необходимо кликнуть *allow*.
10. Скаченный сертификат поместить *Настройки > Безопасность и конфиденциальность > Безопасность > Настроить сертификаты > Импортировать скаченный сертификат в раздел "Доверенные корневые центры сертификации"*
11. В Charles Proxy перейти "Proxy > SSL Proxying Settings":

      - поставить галочку *Enable SSL Proxying*

      - в Include добавить: host <code>*.*</code>, host <code>*</code>, host <code>[]</code>


**Отключить прокси:**
- *Параметры ПК > Сеть и интернет > Прокси сервер > Отключить настройки прокси вручную*

#### настройка для мобильного устройства Android
1. Установить приложение Charles Proxy
2. Запустить Charles Proxy
3. Поставить галочку *Proxy > Windows (IOS) Proxy*
4. Установить сертификат *Help > SSL Proxying > Install Charles Root Certificate > Установить сертификат > Помещаем в "Доверенные корневые центры сертификации" (для текущего и локального пользователя)*. Должно появиться уведомление об успешном импорте сертификата.
5. Перейти "Proxy > SSL Proxying Settings":

     - поставить галочку *Enable SSL Proxying*
     - в Include добавить: host <code>*.*</code>, host <code>*</code>, host <code>[]</code>
6. Запомнить Имя узла прокси и Порт: *Help > SSL proxying > Install Charles Root Certificate on a Mobile Device or Remote Browser*
7. **В телефоне:** *Свойства сети > Название сети Wi-fi сети > Прокси > Вручную* заполнить:

     - Имя хоста: имя узла прокси
     - Порт: порт
8. Перейти на сайт [chils.pro/ssl](chils.pro/ssl) в мобильном браузере для скачивания корневого сертификата. 

     - если все верно настроено, то появится автоматическое скачивание сертификата
     - в этот момент появится входящее соединение, необходимо кликнуть *allow*.
9. Устанавливаем сертификат

**Отключить прокси:**
- ПК: *Параметры ПК > Сеть и интернет > Прокси сервер > Отключить настройки прокси вручную*
- Мобильное устройство: *Свойства сети > Название сети Wi-fi сети > Прокси > Отключить*

#### настройка для мобильного устройства IOS
1. Установить приложение Charles Proxy
2. Запустить Charles Proxy
3. Поставить галочку *Proxy > Windows (IOS) Proxy*
4. Установить сертификат *Help > SSL Proxying > Install Charles Root Certificate > Установить сертификат > Помещаем в "Доверенные корневые центры сертификации" (для текущего и локального пользователя)*. Должно появиться уведомление об успешном импорте сертификата.
5. Перейти "Proxy > SSL Proxying Settings":
  - поставить галочку *Enable SSL Proxying*
  - в Include добавить: host <code>*.*</code>, host <code>*</code>, host <code>[]</code>
6. Запомнить Имя узла прокси и Порт: *Help > SSL proxying > Install Charles Root Certificate on a Mobile Device or Remote Browser*
7. **В телефоне:** *Свойства сети > Название сети Wi-fi сети > Настройка прокси > Вручную* заполнить:

     - Имя хоста: имя узла прокси
     - Порт: порт
8. Перейти на сайт [chils.pro/ssl](chils.pro/ssl) или [charlesproxy.com/getssl](charlesproxy.com/getssl) в мобильном браузере для скачивания корневого сертификата.

     - если все верно настроено, то появится автоматическое скачивание сертификата
     - в этот момент появится входящее соединение, необходимо кликнуть *allow*.
9. Устанавливаем сертификат:

     - перейти *Настройки > Профиль загружен > Установить*

     - перейти *Настройки >  Основные > Об этом устройстве > Доверие сертификатам > Найти сертификат Charles Proxy и включить доверие*


**Отключить прокси:**
- ПК: *Параметры ПК > Сеть и интернет > Прокси сервер > Отключить настройки прокси вручную*
- Мобильное устройство: *Настройки >  Основные > Об этом устройстве > Доверие сертификатам > Найти сертификат Charles Proxy и отключить доверие*
- Мобильное устройство: *Свойства сети > Название сети Wi-fi сети > Настройки прокси > Выключить*

# Просмотр установленных цифровых сертификатов
[Цифровые сертификаты](https://hd01.ru/info/kak-posmotret-ustanovlennye-sertifikaty-windows-10/)  

#### Windows
Cертификаты для оборудования, сгенерированными Microsoft и другими разработчиками для правильного функционирования компьютера:
1. Нажать сочетание клавиш <code>Win + R</code>
2. Ввести в поле "открыть": <code>certlm.msc</code>  

Сертификаты текущего пользователя:  
1. Нажать сочетание клавиш <code>Win + R</code>
2. Ввести в поле "открыть": <code>certmgr.msc</code>

#### Android
1. *Настройки телефона > Безопасность > Сертификаты*

# Работа в Charles Proxy
[официальная документация](https://www.charlesproxy.com/documentation/getting-started/)
#### Breakpoint
​	**Breakpoint** -  это некая точка остановки запроса. Когда появляется запрос из заданного списка Breakpoint, то появляется окно для дальнейшего ручного взаимодействия с параметрами запроса. Удобно использовать, когда необходимо протестировать Api или разные ответы от сервера.
1. Перейти *Proxy > Breakpoint Settings*
2. В окне: 

     - поставить галочку *Enable Breakpoints* 
     - кликнуть по *add*, добавить полный url в поле Host и кликнуть в любое место окна Edit Breakpoint
     - выбираем что необходимо перехватить Request (запрос) и/или Response (ответ)
3. Через браузер или постман отправляем запрос по данному url
     - если настроено все верно, то Charles Proxy поставит запрос(ответ) на паузу и появится окно, где можно вносить изменения
4. Кликаем по кнопке "Execute" - выполнить

#### Rewrite
​	**Rewrite** - это инструмент, позволяющий создавать правила, которые изменяют запросы и ответы, когда те проходят через Charles Proxy. Например, можно добавлять и изменять заголовок, искать и заменять текст в теле ответа или запроса, и т.д.
1. Перейти *Tools > Rewrite*
2. В окне: 

     - поставить галочку *Enable Rewrite* 
     - кликнуть по *add*, в поле *Name* можно ввести любое название подмены, либо оставить по умолчанию «Untitled Set»
     - в разделе *Location* кликнуть *Add*, добавить полный url в поле Host и кликнуть в любое место окна Edit Location
     - в разделе *Rewrite Rule* кликнуть *Add*, изменяем параметр и его значение. Выбираем местонахождение изменяемого параметра Type, Request/Response
3. Через браузер или постман отправляем запрос по данному url

#### Throttle Settings
​	**Throttle Settings** - функция, позволяющая задавать разные параметры скорости соединения с выбранным доменом.
1. Перейти *Proxy → Throttle Settings*
2. В окне: 
     - поставить галочку *Enable Throttle* 
     - можно использовать *Throttle preset* и там выбрать подходящую для теста скорость, а система автоматически заполнит остальные поля.
     - можно выбрать «Only for selected hosts», то можно задать определенный хост, к которому будут применяться ваши настройки. Здесь можно использовать готовые пресеты с настройками для различных типов (4G, 3G и т. д.). А также можно задать различные параметры:
          - Bandwidth — максимальный объем данных, который может быть передан с течением времени.
          - Utilisation — доля общей пропускной способности, которая может быть предоставлена пользователю в любой момент времени.
          - Latency — задержка в миллисекундах по запросу firts между клиентом и удаленным сервером.
          - MTU — максимальное передающее устройство для текущего пресета.
          - Reliability — мера вероятности, что соединение не удастся. Используется для имитации ненадежных сетевых условий.
          - Stability — мера вероятности, что соединение будет нестабильным и, следовательно, снизится качество. Полезно для моделирования сетей, в которых периодических падает качество связи, например, мобильных.
3. В меню кликнуть иконку "черепашка"
4. Через браузер или постман отправляем запрос по данному url

#### Map Remote
​	**Map Remote** - позволяет переадресовать запросы с одного URL «Map From» на другой «Map To». Подменяет хост, путь целиком или только параметры в зависимости от задачи.
1. Перейти  Перейти *Proxy → Map Remote Settings*
2. В окне: 
     - поставить галочку *Enable Map Remote*
     - From - ввести url
     - To - ввести url
3. Через браузер отправляем запрос url (из from)
